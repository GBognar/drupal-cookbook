# www to non-www redirect -- duplicate content is BAD:
# https://github.com/h5bp/html5-boilerplate/blob/5370479476dceae7cc3ea105946536d6bc0ee468/.htaccess#L362
# Choose between www and non-www, listen on the *wrong* one and redirect to
# the right one -- http://wiki.nginx.org/Pitfalls#Server_Name
# For additional tuning, see
#   http://wiki.nginx.org/Drupal
#   and
#   https://github.com/perusio/drupal-with-nginx
server {
  # The host name to respond to
  server_name <%= @server_name %>;
  listen <%= @server_port %>; # for Linux


  # Optional path for static files
  # root /sites/example.com/public;
  root <%= @location_root %>;

  #Specify a charset
  charset utf-8;

  # Added to support the import of large files
  client_max_body_size 2M;
  location <%= @location %> {
      # This is cool because no php is touched for static content
      try_files $uri @rewrite;
      } # location /
  location @rewrite {
    # You have 2 options here
    # For D7 and above:
    # Clean URLs are handled in drupal_environment_initialize().
    rewrite ^ /index.php;
    # For Drupal 6 and bwlow:
    # Some modules enforce no slash (/) at the end of the URL
    # Else this rewrite block wouldn't be needed (GlobalRedirect)
    #rewrite ^/(.*)$ /index.php?q=$1;
    } # location @rewrite

  location ~ \.php$ {
    fastcgi_split_path_info ^(.+\.php)(/.+)$;
    #NOTE: You should have "cgi.fix_pathinfo = 0;" in php.ini
    include fastcgi_params;
    fastcgi_param SCRIPT_FILENAME $request_filename;
    fastcgi_intercept_errors on;
    fastcgi_pass <%= @fast_cgi_pass %>;

  } # location ~ \.php$

} # server
